{"version":3,"sources":["uni-app:///main.js","webpack:///D:/1项目实践/前端代码！！！/pages/search/search.vue?d296","webpack:///D:/1项目实践/前端代码！！！/pages/search/search.vue?cf72","webpack:///D:/1项目实践/前端代码！！！/pages/search/search.vue?a133","webpack:///D:/1项目实践/前端代码！！！/pages/search/search.vue?2fab","uni-app:///pages/search/search.vue"],"names":["createPage","Page"],"mappings":"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","file":"pages/search/search.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/search/search.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./search.vue?vue&type=template&id=4cedc0c6&\"\nvar renderjs\nimport script from \"./search.vue?vue&type=script&lang=js&\"\nexport * from \"./search.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/search/search.vue\"\nexport default component.exports","export * from \"-!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./search.vue?vue&type=template&id=4cedc0c6&\"","var components = {\n  userList: function() {\n    return import(\n      /* webpackChunkName: \"components/user-list/user-list\" */ \"@/components/user-list/user-list.vue\"\n    )\n  }\n}\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./search.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./search.vue?vue&type=script&lang=js&\"","<template>\n\t<view>\r\n\t\t\r\n\t\t<!-- 自定义导航 -->\r\n\t\t<!-- #ifndef APP-PLUS -->\r\n\t\t<view style=\"display: flex;\r\n\t\talign-items: center;\r\n\t\tpadding:0 20upx;height: 88upx;\r\n\t\tposition: fixed;z-index: 9999;\r\n\t\tleft: 0;\r\n\t\ttop: 0;\r\n\t\tright: 0;\r\n\t\tbackground: #FFFFFF;\">\r\n\t\t\t<view class=\"iconfont icon-sousuo\" \r\n\t\t\tstyle=\"position: absolute;left: 30upx;color: #CCCCCC;\"></view>\r\n\t\t\t<input style=\"flex: 1;padding: 5upx 0 5upx 50upx;border-radius: 4px;background: #F7F7F7;\" \r\n\t\t\ttype=\"text\" v-model=\"searchtext\" @confirm=\"getdata\"\r\n\t\t\t:placeholder=\"getPlaceholder\" \r\n\t\t\tplaceholder-style=\"color: #CCCCCC;\"/>\r\n\t\t\t<text style=\"padding-left:20upx;\"\r\n\t\t\t@click=\"goBack\">取消</text>\r\n\t\t</view>\r\n\t\t<view style=\"height: 88upx;\"></view>\r\n\t\t<!-- #endif -->\r\n\t\t\r\n\t\t<template v-if=\"list.length>0\">\r\n\t\t\t<block v-for=\"(item,index) in list\" :key=\"index\">\r\n\t\t\t\t<template v-if=\"searchType == 'post'\">\r\n\t\t\t\t\t<index-list @changeevent=\"updateData\" :item=\"item\" :index=\"index\"></index-list>\r\n\t\t\t\t</template>\r\n\t\t\t\t<template v-else-if=\"searchType == 'topic'\">\r\n\t\t\t\t\t<view style=\"padding:0 20upx;\">\r\n\t\t\t\t\t\t<topic-list :item=\"item\" :index=\"index\"></topic-list>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</template>\r\n\t\t\t\t<template v-else>\r\n\t\t\t\t\t<view style=\"padding:0 20upx;\">\r\n\t\t\t\t\t\t<user-list :item=\"item\" :index=\"index\" hidden></user-list>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</template>\r\n\t\t\t</block>\r\n\t\t\t<load-more :loadtext=\"loadtext\"></load-more>\r\n\t\t</template>\n\t\t<template v-else-if=\"issearch && list.length<1\">\r\n\t\t\t<no-thing></no-thing>\r\n\t\t</template>\n\t</view>\n</template>\n\n<script>\r\n\timport indexList from \"../../components/index/index-list.vue\";\r\n\timport noThing from \"../../components/common/no-thing.vue\";\r\n\timport loadMore from \"../../components/common/load-more.vue\";\r\n\timport topicList from \"../../components/news/topic-list.vue\";\r\n\timport userList from \"../../components/user-list/user-list.vue\";\n\texport default {\r\n\t\tcomponents:{\r\n\t\t\tindexList,\r\n\t\t\tnoThing,\r\n\t\t\tloadMore,\r\n\t\t\ttopicList,\r\n\t\t\tuserList\r\n\t\t},\n\t\tdata() {\n\t\t\treturn {\r\n\t\t\t\tissearch:false,\r\n\t\t\t\tloadtext:\"上拉加载更多\",\n\t\t\t\tlist:[],\r\n\t\t\t\tsearchtext:\"\",\r\n\t\t\t\tpage:1,\r\n\t\t\t\tsearchType:\"post\"\n\t\t\t};\n\t\t},\r\n\t\t// 监听原生标题导航按钮点击事件(取消按钮)\r\n\t\tonNavigationBarButtonTap(e){\r\n\t\t\tif(e.index==0){\r\n\t\t\t\tuni.navigateBack({\r\n\t\t\t\t\tdelta: 1\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 监听搜索框文本变化\r\n\t\tonNavigationBarSearchInputChanged(e){\r\n\t\t\tthis.searchtext=e.text;\r\n\t\t},\r\n\t\t// 监听点击搜索按钮事件\r\n\t\tonNavigationBarSearchInputConfirmed(e){\r\n\t\t\tif(e.text){ this.getdata(); }\r\n\t\t},\r\n\t\t// 监听页面触底事件\r\n\t\tonReachBottom() {\r\n\t\t\tthis.loadmore();\r\n\t\t},\r\n\t\t// 监听下拉刷新\r\n\t\tonPullDownRefresh() {\r\n\t\t\tthis.getdata();\r\n\t\t\tuni.stopPullDownRefresh();\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\tgetPlaceholder() {\r\n\t\t\t\tlet type = '文章'\r\n\t\t\t\tif (this.searchType == 'post') {\r\n\t\t\t\t\ttype = '文章';\r\n\t\t\t\t}else if(this.searchType == 'topic'){\r\n\t\t\t\t\ttype = '话题';\r\n\t\t\t\t}else if(this.searchType == 'user'){\r\n\t\t\t\t\ttype = '用户';\r\n\t\t\t\t}\r\n\t\t\t\treturn '搜索'+type;\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad(e) {\r\n\t\t\tif (!e) return;\r\n\t\t\tthis.searchType = e.searchType || 'post';\r\n\t\t\t// #ifdef APP-PLUS\r\n\t\t\tlet pageTitle = '搜索文章';\r\n\t\t\tif (this.searchType == 'topic') {\r\n\t\t\t\tpageTitle = '搜索话题';\r\n\t\t\t} else if(this.searchType == 'user'){\r\n\t\t\t\tpageTitle = '搜索用户';\r\n\t\t\t}\r\n\t\t\tlet currentWebview = this.$mp.page.$getAppWebview();  \r\n\t\t\tlet tn = currentWebview.getStyle().titleNView;  \r\n\t\t\ttn.searchInput.placeholder = pageTitle; \r\n\t\t\tcurrentWebview.setStyle({  \r\n\t\t\t\ttitleNView: tn  \r\n\t\t\t});\r\n\t\t\t// #endif\r\n\t\t\t// 开启监听\r\n\t\t\tuni.$on('updateData',this.updateData);\r\n\t\t},\r\n\t\tmethods:{\r\n\t\t\t// #ifndef APP-PLUS\r\n\t\t\tgoBack(){\r\n\t\t\t\tuni.navigateBack({\r\n\t\t\t\t\tdelta: 1\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// #endif\r\n\t\t\tupdateData(data){\r\n\t\t\t\tswitch (data.type){\r\n\t\t\t\t\tcase \"guanzhu\":\r\n\t\t\t\t\tthis.updateGuanZhu(data)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"support\":\r\n\t\t\t\t\tthis.updateSupport(data);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'updateComment':\r\n\t\t\t\t\tthis.updateComment(data);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 更新评论数\r\n\t\t\tupdateComment(data){\r\n\t\t\t\t// 拿到当前对象\r\n\t\t\t\tlet obj = this.list.find(value =>{\r\n\t\t\t\t\treturn value.id === data.post_id;\r\n\t\t\t\t});\r\n\t\t\t\tif (!obj) return;\r\n\t\t\t\tobj.commentnum++; // 评论数+1\r\n\t\t\t},\r\n\t\t\t// 更新顶踩数据状态\r\n\t\t\tupdateSupport(data){\r\n\t\t\t\t// 拿到当前对象\r\n\t\t\t\tlet obj = this.list.find(value =>{\r\n\t\t\t\t\treturn value.id === data.post_id;\r\n\t\t\t\t});\r\n\t\t\t\tif (!obj) return;\r\n\t\t\t\tlet oldindex = obj.infonum.index; // 操作前的状态\r\n\t\t\t\tobj.infonum.index = (data.do == 'ding') ? 1 : 2; // 操作后的状态\r\n\t\t\t\tif (oldindex !== 0) { //之前操作过\r\n\t\t\t\t\toldindex == 1 ? obj.infonum.dingnum-- : obj.infonum.cainum--;\r\n\t\t\t\t}\r\n\t\t\t\tif (obj.infonum.index !== 0) {  // 当前操作\r\n\t\t\t\t\tobj.infonum.index == 1 \r\n\t\t\t\t\t\t? obj.infonum.dingnum++ : obj.infonum.cainum++;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 更新关注信息\r\n\t\t\tupdateGuanZhu(data){\r\n\t\t\t\tthis.list.forEach((item,index)=>{\r\n\t\t\t\t\tif (item.userid === data.userid) {\r\n\t\t\t\t\t\titem.isguanzhu = data.data;\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 搜索事件\r\n\t\t\tasync getdata(){\r\n\t\t\t\tuni.showLoading({title:\"Loading...\"});\r\n\t\t\t\tlet url = '/search/'+this.searchType;\r\n\t\t\t\tlet [err,res] =await this.$http.post(url,{\r\n\t\t\t\t\tkeyword:this.searchtext,\r\n\t\t\t\t\tpage:this.page\r\n\t\t\t\t},{token:true});\r\n\t\t\t\tlet error = this.$http.errorCheck(err,res,()=>{\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\tthis.issearch=true;\r\n\t\t\t\t},()=>{\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\tthis.issearch=true;\r\n\t\t\t\t});\r\n\t\t\t\tif (!error) return;\r\n\t\t\t\tlet arr = [];\r\n\t\t\t\tlet list = res.data.data.list;\r\n\t\t\t\tconsole.log(res)\r\n\t\t\t\tfor (let i = 0; i < list.length; i++) {\r\n\t\t\t\t\tarr.push(this.__format(list[i]));\r\n\t\t\t\t}\r\n\t\t\t\tthis.list = this.page > 1 ? this.list.concat(arr) : arr;\r\n\t\t\t\tthis.issearch = true;\r\n\t\t\t\tthis.loadtext= list.length < 10 ? \"没有更多数据了\" : \"上拉加载更多\";\r\n\t\t\t\tuni.hideLoading();\r\n\t\t\t},\r\n\t\t\t// 上拉加载\r\n\t\t\tloadmore(){\r\n\t\t\t\tif(this.loadtext!=\"上拉加载更多\"){ return; }\r\n\t\t\t\t// 修改状态\r\n\t\t\t\tthis.loadtext=\"加载中...\";\r\n\t\t\t\tthis.page++;\r\n\t\t\t\tthis.getdata();\r\n\t\t\t},\r\n\t\t\t// 格式转化\r\n\t\t\t__format(item){\r\n\t\t\t\tswitch (this.searchType){\r\n\t\t\t\t\tcase \"post\":\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tuserid:item.user.id,\r\n\t\t\t\t\t\tuserpic:item.user.userpic,\r\n\t\t\t\t\t\tusername:item.user.username,\r\n\t\t\t\t\t\tisguanzhu:!!item.user.fens.length,\r\n\t\t\t\t\t\tid:item.id,\r\n\t\t\t\t\t\ttitle:item.title,\r\n\t\t\t\t\t\ttype:\"img\", // img:图文,video:视频\r\n\t\t\t\t\t\ttitlepic:item.titlepic,\r\n\t\t\t\t\t\tvideo:false,\r\n\t\t\t\t\t\tpath:item.path,\r\n\t\t\t\t\t\tshare:!!item.share,\r\n\t\t\t\t\t\tinfonum:{\r\n\t\t\t\t\t\t\tindex:(item.support.length>0) ? (item.support[0].type+1) : 0,\r\n\t\t\t\t\t\t\tdingnum:item.ding_count,\r\n\t\t\t\t\t\t\tcainum:item.cai_count,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcommentnum:item.comment_count,\r\n\t\t\t\t\t\tsharenum:item.sharenum,\r\n\t\t\t\t\t\tsex:item.user.userinfo.sex,\r\n\t\t\t\t\t\tage:item.user.userinfo.age,\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"topic\":\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tid:item.id,\r\n\t\t\t\t\t\ttitlepic:item.titlepic,\r\n\t\t\t\t\t\ttitle:item.title,\r\n\t\t\t\t\t\tdesc:item.desc,\r\n\t\t\t\t\t\ttotalnum:item.post_count,\r\n\t\t\t\t\t\ttodaynum:item.todaypost_count,\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"user\":\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tid:item.id,\r\n\t\t\t\t\t\tuserpic:item.userpic,\r\n\t\t\t\t\t\tusername:item.username,\r\n\t\t\t\t\t\tage:item.userinfo.age,\r\n\t\t\t\t\t\tsex:item.userinfo.sex,\r\n\t\t\t\t\t\tisguanzhu:false\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t},\r\n\t\t}\n\t}\n</script>\n\n<style>\n\n</style>\n"],"sourceRoot":""}